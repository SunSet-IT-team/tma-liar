# Dev Dockerfile для backend с hot-reload
FROM oven/bun:1.3.5-alpine

# Устанавливаем netcat-openbsd для health checks
RUN apk add --no-cache netcat-openbsd

WORKDIR /app

# Устанавливаем зависимости (копируем только package.json для кеширования)
COPY package.json bun.lock* ./
COPY tsconfig.json ./
COPY apps/backend/package.json ./apps/backend/
COPY packages/shared/package.json ./packages/shared/
COPY packages/shared ./packages/shared

# Устанавливаем зависимости
RUN bun install

EXPOSE 3000

ENV NODE_ENV=development
ENV PORT=3000

# Запуск в dev режиме с watch
WORKDIR /app/apps/backend
CMD ["bun", "--watch", "src/index.ts"]

